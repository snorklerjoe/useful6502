AS = ca65
LD = ld65
TARGET = loader6502.bin
PYFILE = loader6502.py
SRC = loader6502.s
OBJ = loader6502.o
CFG = loader6502.cfg

all: $(PYFILE)

$(OBJ): $(SRC)
	$(AS) $< -o $@

$(TARGET): $(OBJ)
	$(LD) -C $(CFG) -o $@ $<

$(PYFILE): $(TARGET)
	@echo "# Generated loader6502 bytecode" > $@
	@echo "# (DO NOT EDIT THIS FILE)" >> $@
	@echo "loader6502_code = [" >> $@
	@od -An -tx1 -v $< | sed 's/^ *//' | sed 's/ /,0x/g' | sed 's/^/    0x/' | sed 's/$$/,/' | sed '$$s/,$$//' >> $@
	@echo "]" >> $@

clean:
	rm -f $(OBJ) $(TARGET) $(PYFILE)

.PHONY: all clean
